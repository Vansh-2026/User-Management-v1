"use strict";var e=require("jsonwebtoken"),t=require("fs"),n=require("path"),o=require("os"),r=require("child_process"),s=require("readline"),i=require("crypto"),a=require("util"),c=require("glob"),u=require("https"),d=require("http"),l=require("url");function p(e){var t=Object.create(null);return e&&Object.keys(e).forEach(function(n){if("default"!==n){var o=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,o.get?o:{enumerable:!0,get:function(){return e[n]}})}}),t.default=e,Object.freeze(t)}var h=p(n);function f(t,n){return new Promise((o,r)=>{e.verify(t,n,{algorithms:["RS256"]},function(e,t){e&&r(e),o(t)})})}async function m(e,t){const n=await f(e,t);return n.licenses?.length>0&&await Promise.all(n.licenses.map(e=>f(e,t))),n}const w="https://licensing.telerik.com",y=w+"/api/v1/key",g=w+"/api/v1/usage",E="-----BEGIN PUBLIC KEY-----\nMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA2mnUVMmkth2x+N/ODszG\nOFIYBL6NOO1XWRj1wkmecKuLziJDhFz0WQmyOjY34Ymg9pLuBA9QSWrrZuvPw40N\nm0X/GBmttFmPNvca3WmJ2oKM7PpLiUU9f7Ov5WeIXnx++ts/LC/OB7FtZ+LiRgJ7\n0mZnPeTogdFrASf0zSQJv4jmX840LPa6nomWeUgIVGPLLVI14Gib8Dl+nOckqCNc\nkAUUk4IBF67DufRt9zQyRxg99ysakvHX2SDbdGvIBdxWxvhhmrBoeix0uSVtG2gm\njdvSqlPJVdvMbk1Xe2+SUldJPrxH1VrTYeRUt4yqWxy16nFJUDj9exZ202X4THkU\nJQIDAQAB\n-----END PUBLIC KEY-----",I=Object.freeze({CLIENT_ID:"kendo.licensing.cli.v1",CLIENT_SECRET:"349c875fc2d084006df60ae4b7b63c0d",AUTHORIZATION_URL:"https://identity.telerik.com/login",TOKEN_URL:"https://identity.telerik.com/v2/oauth/telerik/token",CALLBACK_PATH:"/callback"}),T=["TELERIK_LICENSE","KENDO_UI_LICENSE"],C="telerik-license.txt",v=[C,"kendo-ui-license.txt"],U="TELERIK_LICENSING_APIENDPOINTADDRESS",L="localhost",k="/callback",N=3e5,R="https://prgress.co/3PxpDaP",b=["KENDOUIANGULAR","KENDOUICOMPLETE","KENDOUIREACT","KENDOUIVUE"],O=["TF_BUILD","GITHUB_ACTIONS","GITLAB_CI","bamboo.buildKey","BUILDKITE","CIRCLECI","CIRRUS_CI","CODEBUILD_BUILD_ID","HEROKU_TEST_RUN_ID","TEAMCITY_VERSION","TRAVIS","BUILDER_OUTPUT","GERRIT_PROJECT","SYSTEM_TEAMFOUNDATIONCOLLECTIONURI","BITRISE_IO","BUDDY_WORKSPACE_ID","APPVEYOR","CIRCLECI","SEMAPHORE","DRONE","DSARI","TDDIUM","SCREWDRIVER","STRIDER","TASKCLUSTER_ROOT_URL","JENKINS_URL","GO_PIPELINE_NAME","HUDSON_URL","WERCKER","NETLIFY","NOW_GITHUB_DEPLOYMENT","GITLAB_DEPLOYMENT","BITBUCKET_DEPLOYMENT","BITBUCKET_BUILD_NUMBER","NOW_BUILDER","VERCEL_GITLAB_DEPLOYMENT","VERCEL_BITBUCKET_DEPLOYMENT","VERCEL_URL","MAGNUM","NEVERCODE","RENDER","SAIL_CI","SHIPPABLE","TEAMCITY_VERSION","BUILD_ID","CI_NAME","CI"];var A;!function(e){e.BLAZOR="BLAZOR",e.DPL="DPL",e.JM="JM",e.KENDOUIANGULAR="KENDOUIANGULAR",e.KENDOUICOMPLETE="KENDOUICOMPLETE",e.KENDOUIMVC="KENDOUIMVC",e.KENDOUIREACT="KENDOUIREACT",e.KENDOUIVUE="KENDOUIVUE",e.MAUI="MAUI",e.RCAJAX="RCAJAX",e.RCWF="RCWF",e.RCWPF="RCWPF",e.REPORTING="REPORTING",e.REPORTSERVER="REPORTSERVER",e.UIASPCORE="UIASPCORE",e.UIXAM="UIXAM",e.WINUI="WINUI"}(A||(A={}));const P=Object.freeze({[A.BLAZOR]:"Telerik UI for Blazor",[A.DPL]:"Telerik Document Processing",[A.JM]:"Telerik JustMock",[A.KENDOUIANGULAR]:"Kendo UI for Angular",[A.KENDOUICOMPLETE]:"Kendo UI for jQuery",[A.KENDOUIMVC]:"Telerik UI for ASP.NET MVC",[A.KENDOUIREACT]:"KendoReact",[A.KENDOUIVUE]:"Kendo UI for Vue",[A.MAUI]:"Telerik UI for .NET MAUI",[A.RCAJAX]:"Telerik UI for ASP.NET AJAX",[A.RCWF]:"Telerik UI for WinForms",[A.RCWPF]:"Telerik UI for WPF",[A.REPORTING]:"Telerik Reporting",[A.REPORTSERVER]:"Telerik Report Server",[A.UIASPCORE]:"Telerik UI for ASP.NET Core",[A.UIXAM]:"Telerik UI for Xamarin",[A.WINUI]:"Telerik UI for WinUI"}),$=Object.freeze({perpetual:"Perpetual license",subscription:"Subscription license",trial:"Trial license"});function S(){const e=process.env.INIT_CWD||process.cwd();return n.resolve(e)}class D extends Error{constructor(e,t,n){super(e),this.name=this.constructor.name,this.exitCode=t,this.suggestion=n,"captureStackTrace"in Error&&Error.captureStackTrace(this,this.constructor)}}class _ extends D{constructor(e,t){super(e,4,t||"Please check your credentials and try again.")}}class x extends D{constructor(e,t){super(e,5,t||"Check your internet connection and try again.")}}class K extends D{constructor(e,t){super(e,4,t||"Try again to complete authentication.")}}class B extends D{constructor(e,t){super(e,3,t||"Check file permissions and disk space.")}}function j(){const e=o.homedir();if("win32"===o.platform()){const t=process.env.APPDATA||n.join(e,"AppData","Roaming");return n.join(t,"Telerik")}return n.join(e,".telerik")}async function M(e){try{await t.promises.mkdir(e,{recursive:!0})}catch(t){throw new B(`Failed to create directory ${e}: ${t.message}`)}}async function V(e,o){const r=n.dirname(e);try{await M(r);if(!await async function(e){try{return await t.promises.access(e,t.promises.constants.W_OK),!0}catch{return!1}}(r))throw new B(`Permission denied writing to ${e}`);await t.promises.writeFile(e,o,"utf8")}catch(t){if(t instanceof B)throw t;throw"EACCES"===t.code?new B(`Permission denied writing to ${e}`):"ENOSPC"===t.code?new B("Insufficient disk space to write license file"):"ENOENT"===t.code?new B(`Directory does not exist: ${r}`):new B(`Failed to write file ${e}: ${t.message}`)}}async function F(e){if(!await async function(e){try{return await t.promises.access(e),!0}catch{return!1}}(e))return null;const n=`${e}.bak`;try{const o=await async function(e){try{return await t.promises.readFile(e,"utf8")}catch(t){throw"ENOENT"===t.code?new B(`File not found: ${e}`):"EACCES"===t.code?new B(`Permission denied reading file: ${e}`):new B(`Failed to read file ${e}: ${t.message}`)}}(e);return await V(n,o),n}catch(t){throw new B(`Failed to create backup of ${e}: ${t.message}`)}}async function W(e){try{const n=await t.promises.stat(e);return{size:n.size,isDirectory:n.isDirectory()}}catch(e){return{size:0,isDirectory:!1}}}function z(){const e=S().split(n.sep),t=[],o=process.env.TELERIK_LICENSE_PATH;if(o&&o.length>0)return[o];for(let o=0;o<e.length;o++){const r=e.slice(0,e.length-o).join(n.sep);t.push(r||n.sep)}return t.push(j()),t.flatMap(e=>v.map(t=>n.join(e,t)))}function H(){const e=function(){for(const e of z())try{return t.accessSync(e,t.constants.R_OK),e}catch(e){}return null}();if(null!==e){return{success:!0,source:e,value:t.readFileSync(e,{encoding:"utf-8"}).trim()}}return{success:!1,message:z().map(e=>`* ${e}`).join("\n")}}function G(){const e=function(){for(const e of T){const t=process.env[e];if(t&&t.length>0)return{success:!0,source:e,value:t.trim()}}return{success:!1,message:`* Environment Variables: ${T.join(", ")}\n`}}();if(!0===e.success)return e;const t=H();return!0===t.success?t:{success:!1,message:"No Telerik and Kendo UI License file found.\n\nThe following locations were searched:\n"+e.message+t.message+"\n\nTo download a license key file, visit https://prgress.co/3PBSVoC"}}const J=e=>Boolean(e)&&!["0","false","no"].includes(e.trim().toLowerCase()),q=(e,t,n)=>`${((e,t)=>`[${e}][Telerik and Kendo UI Licensing]`+(t?` ${t}:`:""))(e,n)} ${t}`,Y=(e,t)=>console.warn(q("WARN",e,t)),X=e=>console.log(q("INFO",e)),Q=(e,t)=>{J(process.env.TELERIK_LICENSING_DEBUG)&&console.log(q("DEBUG",e,t))};function Z(e){return Math.floor(e.getTime()/1e3)}function ee(){return Z(new Date)}function te(e){const t=ee()-Z(e);return Math.floor(t/86400)}function ne(e){const t=function(e){if("function"==typeof atob)return atob(e);if("function"==typeof Buffer)return Buffer.from(e,"base64").toString("utf8");throw new Error("atob is undefined")}(e),n=new Uint8Array(t.length);for(let e=0;e<t.length;e++)n[e]=t.charCodeAt(e);return n}function oe(e){const t=e.split(".")[1],n=String.fromCharCode(...(o=t,ne(o.replace(/-/g,"+").replace(/_/g,"/"))));var o;return JSON.parse(n)}function re(e){return new Date(1e3*e)}function se(e,t){const n=re(t);return e>new Date(n.getFullYear(),n.getMonth(),n.getDate()+1).getTime()/1e3}function ie(e,t){const n=t.filter(e=>"usage"!==e.type).filter(t=>e.productCode===t.code||e.redistributedBy?.includes(t.code)||e.productCodes?.includes(t.code)).sort((e,t)=>t.expiration-e.expiration);return n.find(e=>"subscription"===e.type&&!se(ee(),e.expiration))||n.find(t=>"perpetual"===t.type&&!se(e.publishDate,t.expiration))||n.find(e=>"subscription"===e.type&&!se(function(e,t){const n=new Date(1e3*e);return n.setDate(n.getDate()+t),Z(n)}(ee(),10),e.expiration))||n.find(e=>"trial"===e.type&&!se(ee(),e.expiration))||n.find(e=>"subscription"===e.type)||n.find(e=>"perpetual"===e.type)||n.find(e=>"trial"===e.type)}const ae=e=>e.productCode||e.productCodes[0],ce=a.promisify(r.exec),ue=t.promises.readFile;function de(e){const t=Buffer.alloc(16);for(let n=0;n<16;n++)t[n]=e[n]^e[n+16];function n(e,n){let o="";for(let r=e;r<=n;r++)o+=t[r].toString(16).padStart(2,"0");return o}return`${n(0,3)}-${n(4,5)}-${n(6,7)}-${n(8,9)}-${n(10,15)}`}async function le(){try{switch(process.platform){case"win32":return await async function(){const e=r.spawn("powershell.exe",["-nologo","-Command","$BIOS = @(Get-WmiObject Win32_BIOS | Select-Object -Property Manufacturer, SerialNumber, Name);$Product = @(Get-WmiObject Win32_ComputerSystemProduct | Select-Object -Property UUID);New-Object -TypeName PSObject -Property @{    'BIOS' = $BIOS;    'Product' = $Product;} | ConvertTo-JSON"]);let t="";const n=s.createInterface(e.stdout);for await(const e of n)t=""==t?e:t+"\n"+e;const o=JSON.parse(t);let a="Telerik Licensing\nWorkstation Id Fingerprint\n";function c(e){null!=e&&""!=e&&(a+=e+";")}a+="BIOS:\n";for(const e of o.BIOS)a+="  - ",c(e.Manufacturer),c(e.SerialNumber),c(e.Name),a+="\n";a+="Product:\n";for(const e of o.Product)a+="  - ",c(e.UUID),a+="\n";const u=i.createHash("sha256");u.update(a);const d=de(u.digest());return{fingerprint:a,id:d}}();case"darwin":return await async function(){const e=(await ce("ioreg -rd1 -w0 -c IOPlatformExpertDevice"))?.stdout?.toString(),{platformUUID:t}=e.match(/"IOPlatformUUID"\s=\s"(?<platformUUID>[0-9A-F-]*)"/).groups,{platformSN:n}=e.match(/"IOPlatformSerialNumber"\s=\s"(?<platformSN>[^"]*)"/).groups,o=(await ce("sysctl hw.model"))?.stdout?.toString(),{hardwareModel:r}=o.match(/^hw.model:\s(?<hardwareModel>.*)$/m).groups,s=`Telerik Licensing\nWorkstation Id Fingerprint\nPlatform UUID: ${t}\nPlatform S/N: ${n}\nHardware model: ${r}\n`,a=i.createHash("sha256");return a.update(s),{fingerprint:s,id:de(a.digest())}}();case"linux":return await async function(){let e="";try{e=(await ue("/etc/machine-id"))?.toString()?.trim()||""}catch{}try{e=e||(await ue("/var/lib/dbus/machine-id"))?.toString()?.trim()||""}catch{}let t="";try{t=(await ue("/sys/devices/virtual/dmi/id/bios_vendor"))?.toString()?.trim()||""}catch{}let n="";try{n=(await ue("/sys/devices/virtual/dmi/id/board_vendor"))?.toString()?.trim()||""}catch{}let o="";try{o=(await ue("/sys/devices/virtual/dmi/id/chassis_vendor"))?.toString()?.trim()||""}catch{}const r=`Telerik Licensing\nWorkstation Id Fingerprint\nMachine Id: ${e}\nBIOS Vendor: ${t}\nBoard Vendor: ${n}\nChassis Vendor: ${o}\n`,s=i.createHash("sha256");return s.update(r),{fingerprint:r,id:de(s.digest())}}();default:throw new Error(`Platform ${process.platform} not supported.`)}}catch(e){return{fingerprint:"<error>",id:"00000000-0000-0000-0000-000000000000"}}}let pe;function he(){return pe||(pe=le())}function fe(e){const t=process.env[e];return t&&"false"!==t.toLowerCase()}function me(){if(fe("TF_BUILD"))return"Azure Pipelines";if(fe("GITHUB_ACTIONS"))return"GitHub Actions";for(const e of O)if(fe(e))return"Other"}async function we(e,t){const n=new AbortController,o=setTimeout(()=>n.abort(),t.timeout);try{const r=await fetch(e,{method:t.method,headers:t.headers,body:t.body,signal:n.signal});clearTimeout(o);const s=await r.text(),i={};return r.headers.forEach((e,t)=>{i[t]=e}),{status:r.status,statusText:r.statusText,headers:i,body:s}}catch(e){if(clearTimeout(o),"AbortError"===e.name)throw new Error(`Request timed out after ${t.timeout}ms`);throw e}}const ye={method:"GET",headers:{},timeout:3e4,retries:3,retryDelay:1e3};async function ge(e,t={}){const n={...ye,...t};let o;for(let t=0;t<n.retries;t++)try{return await we(e,n)}catch(r){o=r;const s=n.retryDelay*Math.pow(2,t);Y(`Network error during ${n.method?.toUpperCase()} ${e}`),X(`Retrying in ${s/1e3} seconds (attempt ${t+1}/${n.retries})...`),await Ee(s)}const r=o?o.message:"Unknown error";throw new x(`Failed to ${n.method?.toLowerCase()} ${e}: ${r}`)}function Ee(e){return new Promise(t=>setTimeout(t,e))}async function Ie(e){const{accessToken:t,outputPath:n}=e;if(!t)throw new D("Access token is required",4,"Complete OAuth authentication first");try{X("Downloading license key...");const e=await async function(e){const t=y;Q(`Fetching license from ${t}`);const n=await async function(e,t={}){return ge(e,{...t,method:"GET"})}(t,{headers:{Authorization:`Bearer ${e}`,Accept:"text/plain"},timeout:3e4});if("string"==typeof n.body&&200===n.status)return n.body;const o=n.status;if(401===o)throw new D("Authentication failed - access token is invalid or expired",4,"Please re-authenticate with the refresh command");if(403===o)throw new D("Access forbidden - insufficient token permissions",4,"The license client may be outdated. Please update and try again.");if(429===o)throw new x("Rate limit exceeded","Wait a few minutes before trying again");if(o>=500)throw new x(`License server error (${o})`,"Try again later or contact support if the problem persists");throw new x(`Unable to fetch key from license API. Server responded with ${o}`,"Please try again later")}(t),o=await async function(e){if(!e){const e=j();return h.join(e,C)}const t=await W(e);if(t.isDirectory||e.endsWith("/")||e.endsWith(h.sep))return h.join(e,C);return e}(n),r={content:e,filename:h.basename(o),filepath:o,size:Buffer.byteLength(e,"utf8"),downloadedAt:new Date};await async function(e){if(!e.content||0===e.content.trim().length)throw new Error("License content cannot be empty");if(!e.filepath||0===e.filepath.trim().length)throw new Error("License file path cannot be empty");const t=await m(e.content,E).catch(()=>null);if(null==t)throw Q("License key content does not appear to be valid: "+e.content),new Error("License key content is not valid")}(r),Q(`Saving license to: ${o}`),await async function(e,t){try{const n=h.dirname(t);await M(n),await F(t),await V(t,e.content),Q(`License file written: ${t}`)}catch(e){throw new B(`Failed to save license to ${t}: ${e.message}`,"Check file permissions and disk space")}}(r,o);return{licenseKey:r,filePath:o,fileSize:(await W(o)).size,downloadedAt:r.downloadedAt}}catch(e){if(e instanceof D)throw e;throw new D(`Failed to download license: ${e.message}`,5,"Check your internet connection and try again")}}function Te(e){try{const n=t.readFileSync(e,{encoding:"utf-8"});return JSON.parse(n)}catch(e){return{}}}const Ce=/@(progress|telerik)\/[^/@"]+/,ve=e=>e.match(Ce)?.[0],Ue=e=>Ce.test(e);function Le(e){const o=function(e){const t=Te(n.join(e,"package-lock.json")).packages||{},o=new Map;for(const e of Object.keys(t)){const n=t[e],r=ve(e);r&&Boolean(n.version)&&o.set(r,n.version)}return o}(e),r=function(e){let o="";try{o=t.readFileSync(n.join(e,"yarn.lock"),{encoding:"utf-8"})}catch(e){}const r=new Map,s=o.split("\n");return s.forEach((e,t)=>{const n=e.startsWith('"@progress/')||e.startsWith('"@telerik/'),o=ve(e);if(n&&o&&t<s.length-1){const e=s[t+1],n=e.match(/version[\s:]+"?([.\d]+)"?/)?.[1];n&&r.set(o,n)}}),r}(e),s=function(...e){const t=new Map;for(const n of e)for(const[e,o]of n.entries())t.set(e,o);return t}(o,r),i=Te(n.join(e,"package.json")),a={...i.dependencies,...i.devDependencies};for(const e of Object.keys(a)){const t=a[e];Ue(e)&&Boolean(t)&&s.set(e,t)}return s}const ke=[{match:e=>"@progress/kendo-ui"===e,code:A.KENDOUICOMPLETE,name:P.KENDOUICOMPLETE},{match:e=>e.startsWith("@progress/kendo-angular-"),code:A.KENDOUIANGULAR,name:P.KENDOUIANGULAR},{match:e=>e.startsWith("@progress/kendo-react-"),code:A.KENDOUIREACT,name:P.KENDOUIREACT},{match:e=>e.startsWith("@progress/kendo-vue-"),code:A.KENDOUIVUE,name:P.KENDOUIVUE}],Ne=e=>e.replace(/^[~^v><= ]+/g,"");function Re(e){let t;const o=S();try{t=require.resolve(e+"/package.json",{paths:[o]})}catch(r){const[s,i]=e.split("/");t=n.join(o,"node_modules",s,i,"package.json")}return t}function be(e){return Boolean(e&&(e.productCode||e.productCodes?.length>0))}async function Oe(e){const t=Le(e).keys(),o=[];for(const e of t){const t=Re(e),r=n.dirname(t),s=Te(t);let i=s["@progress"]?.package;if(be(i))i.name=s.name,i.version=s.version,o.push(i);else{const e=[n.join(r,"esm2022","package-metadata.mjs"),n.join(r,"package-metadata.mjs")];let t;for(;!t&&e.length>0;)t=await import(e.shift()).catch(()=>{});if(t&&t.packageMetadata&&be(t.packageMetadata)){i=t.packageMetadata;const e=i.version||s.version;o.push({...i,version:e})}}}return o}function Ae(e){const t=new Map;for(const n of e){const e=ae(n);let o;t.has(e)?o=t.get(e):(o=new Map,t.set(e,o)),o.has(n.version)||o.set(n.version,{...n,name:"<group>"})}return[...t.values()].flatMap(e=>[...e.values()])}function Pe(e,t){const n=`${e}: `,o=re(t.expiration),r=-te(o);"subscription"===t.type?X(n+`Your ${e} subscription is active. `+`Expiration in ${r} days - ${o.toLocaleDateString()}.`):"trial"===t.type?X(n+`Your ${e} trial expires in ${r} days.`):"perpetual"===t.type&&X(n+"Valid license found.")}class $e{constructor(e,t){this.productName=e,this.severity="WARN",this.code="TKL101",this.licenseEvidence=null,this.message=`${e} is not listed in your current license file.\n  Learn more about ${e} licensing at ${t}`}}class Se{constructor(e,t,n,o,r){this.productName=e,this.licenseEvidence=t,this.severity="WARN",this.code="TKL102",this.message=`Your current license has expired on ${n.toLocaleDateString()} and is not valid for ${e} version ${o}. The product was published on ${r.toLocaleDateString()}.\n  Renew your license at https://prgress.co/3PwQNi1`}}class De{constructor(e,t,n){this.productName=e,this.licenseEvidence=t,this.severity="WARN",this.code="TKL103",this.message=`Your subscription has expired ${n} days ago.\n  Renew your maintenance and support to enjoy uninterrupted service at https://prgress.co/3PwQMut`}}class _e{constructor(e,t,n){this.productName=e,this.licenseEvidence=t,this.severity="WARN",this.code="TKL104",this.message=`Your subscription has expired ${n} days ago.\n  Renew your maintenance and support to enjoy uninterrupted service at https://prgress.co/3PwQMut`}}class xe{constructor(e,t,n){this.productName=e,this.licenseEvidence=t,this.severity="WARN",this.code="TKL105",this.message=`Your trial has expired ${n} days ago.\n  Thank you for trying out ${e}, we hope you enjoyed your trial period.\n  To continue using our product, consider upgrading to a commercial license: https://prgress.co/3PwQMdX`}}const Ke=e=>{let t=(e.licenses||[]).map(e=>oe(e));return 0===t.length&&e.products&&(t=(e.products||[]).map(t=>({type:t.trial?"trial":"perpetual",code:t.code,expiration:t.licenseExpirationDate,licenseId:e.licenseId,userId:e.userId}))),t};function Be(e,t){const n=e.licenses||[],o=Ke(e),r=o.findIndex(e=>"usage"===e.type),s=-1!==r?n[r]:null,i=Ae(t),a=new Map,c=new Map,u=new Map;for(const e of i){const t=e.productCode||e.productCodes[0],n=ie(e,o);if(n)if("subscription"===n.type&&se(ee(),n.expiration)){const o=te(re(n.expiration));o>10?c.set(t,new De(e.productName,n,o)):c.set(t,new _e(e.productName,n,o))}else if("perpetual"===n.type&&se(e.publishDate,n.expiration))c.set(t,new Se(e.productName,n,re(n.expiration),e.version,re(e.publishDate)));else if("trial"===n.type&&se(ee(),n.expiration)){const o=te(re(n.expiration));c.set(t,new xe(e.productName,n,o))}else a.has(n.code)||(a.set(n.code,n),u.set(n.code,e.productName));else c.set(t,new $e(e.productName,e.licensingDocsUrl))}return{productErrors:c,productLicenses:a,productVersions:i,productNames:u,usageEvidence:s}}function je(e,o){const r=S(),s=[n.join(n.join(__dirname,"../dist"),"index*.{js,mjs}"),n.join(r,".angular/cache/**/vite/deps*/chunk-*.js"),n.join(r,".angular/cache/**/vite/deps*/@progress*.js"),n.join(r,".next/static/chunks/*.js"),n.join(r,"node_modules/.vite/deps/chunk-*.js"),n.join(r,"node_modules/.vite/deps/@progress*.js")].map(e=>e.replace(/\\/g,"/")),i=function(e,t){const n=(e.licenses||[]).filter(e=>{const n=oe(e);return"usage"!==n.type&&t.includes(n.code)});return{products:n.length>0?[]:e.products||[],licenses:n,userId:e.userId,integrity:e.integrity,scriptKey:!1,timestamp:e.iat}}(e,o),a=JSON.stringify(JSON.stringify(i)),u=`  ${a.substring(1,a.length-1)}  `;Q(JSON.stringify(i)),c.globSync(s,{nodir:!0}).forEach(e=>{const n=t.readFileSync(e,{encoding:"utf-8"}).replace(/ {2}{.*} {2}/,u);t.writeFileSync(e,n,{encoding:"utf-8"})})}const Me=a.promisify(r.exec);function Ve(){const e=process.platform;return"win32"===e?"win32":"darwin"===e?"darwin":"linux"===e?"linux":"unknown"}async function Fe(e){const{url:t}=e;if(!t||!function(e){try{const t=new URL(e);return"http:"===t.protocol||"https:"===t.protocol}catch{return!1}}(t))throw new D(`Invalid URL: ${t}`,3,"Provide a valid HTTP or HTTPS URL");try{Q(`Opening URL in browser: ${t}`);const e=function(e){const t=Ve();switch(t){case"win32":return`start "" "${e}"`;case"darwin":return`open "${e}"`;case"linux":return`xdg-open "${e}" || gnome-open "${e}" || kde-open "${e}"`;default:throw new D(`Unsupported platform: ${t}`,3,"Please open the URL manually in your browser")}}(t);return Q(`Executing command: ${e}`),await Me(e),Q("Browser opened successfully"),!0}catch(e){return Q(`Failed to open browser: ${e.message}`),!1}}function We(e){const t="━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━";console.log("\n"+t),console.log("  Please open this URL in your browser:"),console.log(t+"\n"),console.log(`  ${e}\n`),console.log(t),console.log(`  ${function(){switch(Ve()){case"win32":case"linux":return"Copy the URL and paste it into your browser's address bar";case"darwin":return"Copy the URL (Cmd+C) and paste it into your browser's address bar";default:return"Open the URL in your web browser"}}()}`),console.log(t+"\n")}const ze=()=>J(process.env.TELERIK_TELEMETRY_INTERNAL);async function He({url:e,payload:t,timeout:n}){const o=e.port?Number.parseInt(e.port,10):void 0,r={protocol:e.protocol,hostname:e.hostname,port:o,path:e.pathname,timeout:n,method:"POST",headers:{"Content-Type":"application/json"}};return new Promise((e,n)=>{const o=(e=>"https:"===e.protocol?u.request(e):d.request(e))(r);o.on("error",e=>{n(e)}),o.on("timeout",()=>{n(new Error("Request timeout"))}),o.on("close",()=>{e()}),o.end(JSON.stringify(t))})}async function Ge(e){return He({url:new URL(process.env[U]||g),payload:e,timeout:3e3})}async function Je(e,t,n){const{id:o}=await he(),r=re(e.expiration).toISOString().split(".")[0]+"Z",s=function(e){if(void 0!==e)return null===e?null:{Type:e.type,CI:e.CI,UserId:e.userId,LicenseId:e.licenseId,WorkstationId:e.workstationId,ProductCode:e.productCode,ProductLicenseType:e.productLicenseType,ProductLicenseValidity:e.productLicenseValidity,ProductVersion:e.productVersion,UsageEvidence:e.usageEvidence,IsInternalUsage:e.isInternalUsage}}({type:"LicenseUsed",userId:e.userId,licenseId:e.licenseId,workstationId:o,productCode:e.code,productLicenseType:e.type,productLicenseValidity:r,productVersion:n,usageEvidence:t,isInternalUsage:!!ze()||void 0,CI:me()});Q("LicenseUsed: "+JSON.stringify(s,null,2)),await Ge(s).catch(e=>{Q(`Failed to send telemetry: ${e}`)})}async function qe({licenseKey:e,licenseEvidence:t,licenseErrorCode:n,usageEvidence:o,productVersion:r,productCode:s}){const{id:i}=await he(),a=t?re(t.expiration).toISOString().split(".")[0]+"Z":void 0,c=function(e){if(void 0!==e)return null===e?null:{Type:e.type,ProductCode:e.productCode,ProductVersion:e.productVersion,LicenseErrorCode:e.licenseErrorCode,ProductLicenseType:e.productLicenseType,ProductLicenseValidity:e.productLicenseValidity,LicenseId:e.licenseId,UserId:e.userId,WorkstationId:e.workstationId,CI:e.CI,IsInternalUsage:e.isInternalUsage,UsageEvidence:e.usageEvidence}}({type:"LicenseNotValid",productCode:s,productVersion:r,licenseErrorCode:n,productLicenseType:t?.type,productLicenseValidity:a,licenseId:e.licenseId,userId:e.userId,workstationId:i,CI:me(),isInternalUsage:!!ze()||void 0,usageEvidence:o});Q(`Workstation ID: ${i}`),Q("LicenseNotValid: "+JSON.stringify(c,null,2)),await Ge(c).catch(e=>{Q(`Failed to send LicenseNotValid telemetry: ${e}`)})}const Ye=()=>(process.env[U]||g).replace("/usage","/collect");async function Xe({productVersion:e,productCode:t}){const{id:n}=await he(),o=function(e){if(void 0!==e)return null===e?null:{Type:e.type,ProductCode:e.productCode,ProductVersion:e.productVersion,WorkstationId:e.workstationId,CI:e.CI,IsInternalUsage:e.isInternalUsage}}({type:"LicenseNotFound",productCode:t,productVersion:e,workstationId:n,CI:me(),isInternalUsage:!!ze()||void 0});Q("LicenseNotFound: "+JSON.stringify(o,null,2)),await async function(e){return He({url:new URL(Ye()),payload:e,timeout:3e3})}(o).catch(e=>{Q(`Failed to send telemetry: ${e}`)})}const Qe={command:"activate",describe:`Validates and imports a Telerik and Kendo UI license key file.\n\nThe following locations are searched for a license key:\n* The path specified in the \${LICENSE_ENV_PATH_VAR} environment variable.\n* The ${T.join(", ")} environment variables.\n* The ${v.join(", ")} files in:\n    * The current working directory\n    * Each parent directory\n    * ~/\${TELERIK_HOME_DIR} (Linux and macOS) or %APPDATA%\\\${TELERIK_HOME_DIR_WIN32} (Windows)`,builder:function(e){return e.option("ignore-no-license",{type:"boolean",description:"Sets the exit status to 0 (success) if a license file is missing.",default:!1})},handler:async function(e){const o=e.ignoreNoLicense,r=S(),{id:s}=await he();Q(`Workstation ID: ${s}`);let i=await Oe(r);0===i.length&&(i=function(e){const t=Le(e),n=[];for(const[e,o]of t){const t=ke.find(t=>t.match(e));t&&n.push({name:e,productName:t.name,productCode:t.code,version:Ne(o),publishDate:-1,licensingDocsUrl:""})}return n}(r));let a=function(e){const t=new Set(e.flatMap(e=>[e.productCode,...e.productCodes||[],...e.redistributedBy||[]]).filter(Boolean));return Array.from(t.values())}(i);0===a.length&&(Y("No Telerik or Kendo UI product references detected in project.\n  Consult the product documentation or contact support at https://prgress.co/3Pzpwvf"),a=b);const c=G();if(!1===c.success){try{await async function(e){const t=Ae(e);for(const e of t)await Xe({productVersion:e.version,productCode:e.productCode})}(i)}catch(e){Q(`Failed to send telemetry: ${e.message}`)}const e="TKL002: "+c.message;if(o)return void X(e);throw new D(e,1)}let u;try{u=await m(c.value,E);const e=re(u.iat).toLocaleString();X(`Telerik and Kendo UI License Key found at: ${c.source}\n  License issued at ${e} to ${u.aud}`)}catch(e){const t=`Corrupted Telerik and Kendo UI License Key content in ${c.source}\n  Download a new copy of the license key from ${R}`;throw new D(t,2)}if(i.length>0){const e=Be(u,i);for(const t of e.productLicenses.values())Q(`Resolved license for ${t.code}, ${t.type}, expires ${re(t.expiration).toISOString()}`);for(const t of e.productErrors.values())Y(t.message,t.code);try{await async function(e,t){if(e.usageEvidence){for(const t of e.productLicenses.values()){for(const n of e.productVersions)ae(n)===t.code&&await Je(t,e.usageEvidence,n.version);Pe(e.productNames.get(t.code),t)}for(const n of e.productErrors.values())for(const o of e.productVersions)o.productName===n.productName&&await qe({licenseKey:t,licenseEvidence:n.licenseEvidence,licenseErrorCode:n.code,usageEvidence:e.usageEvidence,productVersion:o.version,productCode:o.productCode})}}(e,u)}catch(e){Q(`Failed to send telemetry: ${e.message}`)}}try{je(u,a),function(){const e=S(),o=n.resolve(e,".next/cache");t.existsSync(o)&&Y(`Next.js cache detected in ${o}\n  Delete the cache directory to apply the license key in production builds.`)}()}catch(e){throw console.error(e),new D("Error while importing license.",3)}}};function Ze(e,t="localhost"){return new Promise(n=>{const o=d.createServer();o.listen(e,t,()=>{o.close(()=>n(!0))}),o.on("error",()=>{n(!1)})})}class et{constructor(e){const{preferredPort:t,host:n=L,callbackPath:o=k,timeout:r=N}=e;this.state={port:t,host:n,timeout:r,isListening:!1,callbackPath:o,startedAt:new Date,requestsReceived:0},this.httpServer=d.createServer((e,t)=>{this.handleRequest(e,t)}),this.validate()}validate(){if(this.state.port<=0||this.state.port>65535)throw new Error(`Invalid port number: ${this.state.port}`);if("localhost"!==this.state.host&&!tt(this.state.host))throw new Error("Host must be localhost to disable connections from external hosts");if(!this.state.callbackPath.startsWith("/"))throw new Error("Callback path must start with /")}tryStartOnPort(e){return new Promise((t,n)=>{this.httpServer?(this.httpServer.listen(e,this.state.host,()=>{t()}),this.httpServer.on("error",e=>{n(e)})):n(new Error("HTTP server not initialized"))})}setupTimeout(){this.timeoutId=setTimeout(()=>{if(this.callbackPromise){const e=(this.state.timeout||0)/1e3;this.callbackPromise.reject(new K(`OAuth flow timed out after ${e} seconds`,"Please re-run the command and authenticate in the browser"))}this.stop()},this.state.timeout)}handleRequest(e,t){this.state.requestsReceived++,this.state.lastActivity=new Date;if(!tt(e.socket.remoteAddress))return t.statusCode=403,t.setHeader("Content-Type","text/plain"),void t.end("Forbidden: External connections not allowed");if("GET"!==e.method)return t.statusCode=405,t.setHeader("Content-Type","text/plain"),void t.end("Method Not Allowed");if(parseInt(e.headers["content-length"]||"0",10)>0)return t.statusCode=413,t.setHeader("Content-Type","text/plain"),void t.end("Payload Too Large");const n=new l.URL(e.url||"/",`http://${this.state.host}:${this.state.port}`);n.pathname===this.state.callbackPath?(this.handleCallback(n,t),this.stop()):(t.statusCode=404,t.setHeader("Content-Type","text/plain"),t.end("Not Found"))}handleCallback(e,t){const n={code:e.searchParams.get("code")||void 0,state:e.searchParams.get("state")||void 0,error:e.searchParams.get("error")||void 0,error_description:e.searchParams.get("error_description")||void 0};n.error?this.errorResponse(t,n):this.successResponse(t),this.callbackPromise&&(this.callbackPromise.resolve(n),this.callbackPromise=void 0)}errorResponse(e,t){e.statusCode=400,e.setHeader("Content-Type","text/html"),e.end((e=>`\n<!DOCTYPE html>\n<html lang="en">\n<head>\n    <meta charset="utf-8">\n    <title>Login Error</title>\n    <style>body{ font-family:system-ui,sans-serif; padding:2rem; }</style>\n</head>\n<body>\n    <h1>Telerik Licensing - Login Error ❌</h1>\n    <p>${e.error}</p>\n    <p>${e.error_description||"No description provided"}</p>\n    <p>You can close this window and return to the terminal.</p>\n</body>\n</html>\n`)(t))}successResponse(e){e.statusCode=200,e.setHeader("Content-Type","text/html"),e.end('\n<!DOCTYPE html>\n<html lang="en">\n<head>\n    <meta charset="utf-8">\n    <title>Login Successful</title>\n    <style>body{ font-family:system-ui,sans-serif; padding:2rem; }</style>\n</head>\n<body>\n    <h1>Telerik Licensing - Login Successful ✅</h1>\n    <p>You can close this window and return to the terminal.</p>\n</body>\n</html>\n')}async start(){let e=this.state.port;e||(e=await async function(e=3e4,t=5e4){for(let n=0;n<10;n++){const n=Math.floor(Math.random()*(t-e+1))+e;if(await Ze(n))return n}throw new Error(`No available ports found in range ${e}-${t} after 10 attempts`)}(),this.state.port=e),await this.tryStartOnPort(e),this.state.isListening=!0,this.setupTimeout()}waitForCallback(){if(!this.state.isListening)throw new Error("Server is not listening - call start() first");return new Promise((e,t)=>{this.callbackPromise={resolve:e,reject:t}})}async stop(){if(this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=void 0),this.httpServer)return new Promise(e=>{this.httpServer.close(()=>{this.state.isListening=!1,e()})})}getCallbackUrl(){return`http://${this.state.host}:${this.state.port}${this.state.callbackPath}`}getPort(){return this.state.port}isListening(){return this.state.isListening}getRequestCount(){return this.state.requestsReceived}}function tt(e){return"127.0.0.1"===e||"::1"===e||"::ffff:127.0.0.1"===e}async function nt(e){let t,n="";try{t=new et(e),await t.start();const o=t.getPort();n=t.getCallbackUrl(),Q(`Local callback server started on port ${o}`)}catch(e){throw new D(`Failed to start local server: ${e.message}`,5,"Try specifying a different port with --port")}return{callbackUrl:n,callbackData:t.waitForCallback().finally(async()=>{try{Q("Stopping local callback server..."),await t.stop(),Q("Server stopped successfully")}catch(t){throw e=`Error stopping server: ${t.message}`,console.error(q("ERROR",e,n)),new D(`Failed to stop server: ${t.message}`,5,"The server may still be running")}var e,n})}}var ot;!function(e){e.WAITING_FOR_AUTH="waiting",e.CODE_RECEIVED="code_received",e.AUTHENTICATED="authenticated"}(ot||(ot={}));class rt{constructor(e){!function(){if(!I.CLIENT_ID)throw new Error("OAuth CLIENT_ID not configured");if(!I.CLIENT_SECRET)throw new Error("OAuth CLIENT_SECRET not configured");if(!I.AUTHORIZATION_URL)throw new Error("OAuth AUTHORIZATION_URL not configured");if(!I.TOKEN_URL)throw new Error("OAuth TOKEN_URL not configured");try{new URL(I.AUTHORIZATION_URL),new URL(I.TOKEN_URL)}catch(e){throw new Error("Invalid OAuth URL configuration")}}(),this.redirectUrl=e,this.state=this.generateStateParameter(),this.authorizationUrl=this.generateAuthorizationUrl()}handleCallback(e){const{code:t,state:n,error:o,error_description:r}=e;if(o){throw new _(r||`OAuth error: ${o}`,"Please try authenticating again")}if(!t)throw new _("No authorization code received","The OAuth callback was incomplete");if(!n)throw new _("No state parameter received","The OAuth callback was incomplete");try{this.setAuthorizationCode(t,n),Q(`Authorization code received: ${t.substring(0,10)}...`)}catch(o){throw new _(o.message,"Possible security issue - please try again")}}async getAccessToken(){if(this.accessToken)return Q("Returning cached access token"),this.accessToken;if(!this.hasAuthorizationCode())throw new _("No authorization code available","Complete the OAuth flow first");return Q("Access token requested, exchanging code for token..."),await this.exchangeCodeForToken(),this.accessToken}generateAuthorizationUrl(){const e=new URLSearchParams({client_id:I.CLIENT_ID,response_type:"code",redirect_uri:this.redirectUrl,state:this.state});return this.updateStatus(ot.WAITING_FOR_AUTH),`${I.AUTHORIZATION_URL}?${e.toString()}`}async exchangeCodeForToken(){if(!this.hasAuthorizationCode())throw new _("No authorization code available","Complete the OAuth flow first");const e=this.getAuthorizationCode();Q("Exchanging authorization code for access token");try{const r={grant_type:"authorization_code",code:e,redirect_uri:this.redirectUrl,client_id:I.CLIENT_ID},s={"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json",...(n=I.CLIENT_ID,o=I.CLIENT_SECRET,{Authorization:`Basic ${Buffer.from(`${n}:${o}`).toString("base64")}`})};Q(`Making token request to ${I.TOKEN_URL}`);const i=await ge(I.TOKEN_URL,{method:"POST",headers:s,body:(t=r,Object.keys(t).map(e=>`${encodeURIComponent(e)}=${encodeURIComponent(t[e])}`).join("&"))});if(200!==i.status){if(i.status>=400&&i.status<500){let e="";try{const t=JSON.parse(i.body);e=t.error_description||t.error||"Unknown error"}catch{e=`HTTP ${i.status} ${i.statusText}`}throw new _(`Token exchange failed: ${e}`,"Please try authenticating again")}throw new x(`Token service error: HTTP ${i.status}`,"The authentication service may be temporarily unavailable. Please try again later.")}{const e=JSON.parse(i.body);this.validateTokenResponse(e),this.setAccessToken(e.access_token),Q(`Access token received, expires in ${e.expires_in||"unknown"} seconds`)}}catch(e){if(e instanceof _||e instanceof x)throw e;throw new x(`Failed to exchange authorization code: ${e.message}`,"Check your internet connection and try again")}var t,n,o}validateTokenResponse(e){if(!e.access_token)throw new _("Invalid token response: missing access_token");if(e.token_type&&"bearer"!==e.token_type.toLowerCase())throw new _(`Unsupported token type: ${e.token_type}`);3!==e.access_token.split(".").length&&Y("Access token does not appear to be a valid JWT")}generateStateParameter(){return i.randomBytes(16).toString("hex")}updateStatus(e){this.status=e}setAuthorizationCode(e,t){if(t!==this.state)throw new Error("Invalid state parameter - possible CSRF attack");this.authorizationCode=e,this.updateStatus(ot.CODE_RECEIVED)}setAccessToken(e){this.accessToken=e,this.updateStatus(ot.AUTHENTICATED)}hasAuthorizationCode(){return!(!this.authorizationCode||this.status!==ot.CODE_RECEIVED)}getAuthorizationCode(){return this.authorizationCode}}const st={command:"refresh",describe:"Downloads a new license key file after authenticating to telerik.com via a web browser.\nBy default, the license file is saved in the user's home directory.",builder:function(e){return e.option("output",{type:"string",description:"Specify custom license file path"}).option("timeout",{type:"number",description:"Authentication timeout, seconds",default:N/1e3}).option("port",{type:"number",description:"Preferred localhost port (random if not specified)"}).option("browser",{type:"boolean",description:"Automatically open browser",default:!0})},handler:async function(e){const{output:t,timeout:n,port:o,noBrowser:r}=function(e){const t={output:e.output,noBrowser:!e.browser,timeout:e.timeout,port:e.port};if(t.output&&/[<>:"|?*]/.test(t.output))throw new Error(`Invalid characters in output filename: ${t.output}`);if(isNaN(t.timeout)||t.timeout<=0)throw new Error("--timeout must be a positive number");if(t.timeout>0&&(t.timeout*=1e3),void 0!==t.port&&(t.port<=0||t.port>65535))throw new Error("--port must be a valid port number (1-65535)");return t}(e);Q("Starting OAuth authentication flow..."),Q("Starting local callback server...");const s=await nt({preferredPort:o,host:L,timeout:n}),i=s.callbackUrl;Q(`Callback URL: ${i}`);const a=new rt(i),c=a.authorizationUrl;if(Q(`Authorization URL: ${c}`),r)X("Browser opening disabled with --no-browser"),We(c);else{await async function(e){X("Opening browser for authentication...");const t=await Fe({url:e});return t?X("Please complete authentication in your browser"):Y(`Could not open browser automatically. Please open this URL manually:\n  ${e}`),t}(c)||Q("Browser opening failed, showing manual instructions")}X(`Waiting for authentication (timeout in ${n/1e3}s)...`);const u=await s.callbackData;Q("OAuth callback received"),X("Processing callback data..."),a.handleCallback(u);const d=await a.getAccessToken(),l=await Ie({accessToken:d,outputPath:t});X(`License key downloaded successfully to ${l.filePath} (${l.fileSize} bytes)`)}};var it;!function(e){e.Trial="trial",e.Subscription="subscription",e.Perpetual="perpetual"}(it||(it={}));const at={command:"info",describe:"Prints information about the current license.",handler:async function(){console.log("Looking up your Telerik License key file...");const e=G();if(!1===e.success)return void console.error(`License key file not found: ${e.message}`);let t;console.log(`License key file found: ${e.source}\n`);try{t=await m(e.value,E);const n=re(t.iat).toLocaleString();console.log(`  License key:\n     Audience: ${t.aud}\n     Issued At: ${n}\n     License Id: ${t.licenseId}\n     Used Id: ${t.userId}`)}catch(e){return void console.log(`Corrupted Telerik and Kendo UI License Key content\nDownload a new copy of the license key from ${R}`)}(function(e){const t=Ke(e);if(0===t.length)return void console.log("  No license evidences found in the License Key.\n");console.log("     Products:");for(const e of t){if("usage"===e.type)continue;const t=P[e.code]||e.code;console.log(`       ${t}`),console.log(`       ${dt(e)}\n`)}})(t),await async function(e){const t=S(),n=await Oe(t);if(0===n.length)return void console.log("No product references detected in package.json\n");const o=Be(e,n);if(o.productLicenses.size>0){console.log("  Licensed products in current project:");for(const e of o.productLicenses.values()){const t=P[e.code]||e.code,n=$[e.type],r=o.productVersions.find(t=>(t.productCode||t.productCodes[0])===e.code)?.version||"N/A";console.log(`      ${ct} ${t} version ${r} (${n})\n`)}}if(o.productErrors.size>0){console.log("  Products with missing or expired licenses in current project:");for(const e of o.productErrors.values())console.log(`    ${ut} ${e.productName}\n`)}}(t)}},ct="✓",ut="✗";function dt(e){const t=e.expiration?re(e.expiration).toLocaleDateString():"N/A",n=!!e.expiration&&Date.now()>=1e3*e.expiration,o=n?ut:ct;return e.type===it.Trial?`${o} Trial license - ${n?"expired on":"expires on"} ${t}`:e.type===it.Subscription?`${o} Subscription license - ${n?"expired on":"valid until"} ${t}`:e.type===it.Perpetual?`${ct} Perpetual license - valid for versions released before ${t}`:void 0}exports.activateCommand=Qe,exports.decodeLicenseEvidence=async function(e){return await f(e,E)},exports.decodeLicenseKey=async function(e){return await m(e,E)},exports.helpCommand={command:"help",describe:"Prints this help message.",handler:()=>{}},exports.infoCommand=at,exports.loadLicense=G,exports.refreshCommand=st;
